# Lefthook configuration for cmd-runner
# https://github.com/evilmartians/lefthook

pre-commit:
  parallel: true
  commands:
    go-fmt:
      glob: "*.go"
      run: gofmt -l {staged_files}
      fail_text: "Please run 'go fmt ./...' to format Go files"
    
    go-vet:
      glob: "*.go"
      run: go vet ./...

    go-imports:
      glob: "*.go"
      run: |
        if command -v goimports >/dev/null 2>&1; then
          goimports -l {staged_files}
        fi
      fail_text: "Please run 'goimports -w' on the files"

pre-push:
  parallel: false
  commands:
    go-fmt-check:
      run: |
        unformatted=$(gofmt -l .)
        if [ -n "$unformatted" ]; then
          echo "Unformatted files:"
          echo "$unformatted"
          exit 1
        fi
      fail_text: "❌ Code is not formatted. Run 'go fmt ./...'"

    go-vet:
      run: go vet ./...
      fail_text: "❌ go vet failed"

    go-test:
      run: go test ./...
      fail_text: "❌ Tests failed"

    go-build:
      run: go build -o /dev/null ./cmd/cmdr
      fail_text: "❌ Build failed"

commit-msg:
  commands:
    check-commit-message:
      run: |
        # Check if commit message is not empty and has proper format
        if [ -z "$(grep '[^[:space:]]' $1)" ]; then
          echo "Commit message cannot be empty"
          exit 1
        fi